#include <inc/lib.h>

void sort(unsigned *a, int n);

int
atoi(const char *s)
{
	int ans = 0;
	while(*s) ans = ans * 10 + (*s++ - '0');
	return ans;
}

static union
{
	char USER_STACK[64 << 20];
	struct
	{
		unsigned a[10000007]; int n;
	};
} u;

void
sort_wrapper(void)
{
	sort(u.a, u.n);
	sys_quit_judge();
}

void
umain(int argc, char **argv)
{
	if(argc != 2)
	{
		cprintf("usage: %s [n]", argv[0]);
		return;
	}
	cprintf("SORTLIB: I am sort.lib, making data at %p......\n", u.a);
	u.n = atoi(argv[1]);
	u.a[0] = 998244353u;
	for(int i = 1; i < u.n; i++)
		u.a[i] = u.a[i - 1] * 13131u + 3131313u;
	cprintf("SORTLIB: data ready, before sys_enter_judge......\n");
	int ret = sys_enter_judge(sort_wrapper);
	cprintf("SORTLIB: sys_enter_judge returned %d\n", ret);
	for(int i = 1; i < u.n; i++)
		if(u.a[i] < u.a[i - 1])
		{
			cprintf("SORTLIB: Wrong Answer at %d\n", i);
			return;
		}
	cprintf("SORTLIB: Correct Answer!\n");
}
